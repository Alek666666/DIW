<!DOCTYPE html>
<!-- saved from url=(0059)https://ncode.amorce.org/ressources/Pool/PHP/MVC/MVC-3.html -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>nCode | AmÃ©lioration avec un contrÃ´leur frontal</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="./nCode _ AmÃ©lioration avec un contrÃ´leur frontal_files/font-awesome.min.css">
        <link rel="stylesheet" href="./nCode _ AmÃ©lioration avec un contrÃ´leur frontal_files/bootstrap.min.css">
        <link rel="stylesheet" href="./nCode _ AmÃ©lioration avec un contrÃ´leur frontal_files/darcula.css">
        <!-- <link rel="stylesheet" href="/css/highlight/line-number.css"> -->
        <link rel="stylesheet" href="./nCode _ AmÃ©lioration avec un contrÃ´leur frontal_files/github-markdown.css">
        <!-- <link rel="stylesheet" href="/css/markdown_foad.css"> -->
        <link rel="stylesheet" href="./nCode _ AmÃ©lioration avec un contrÃ´leur frontal_files/menu-markdown.css">
        <!-- <script src="/js/highlightjs-line-numbers.min.js"></script> -->
        <script src="./nCode _ AmÃ©lioration avec un contrÃ´leur frontal_files/jquery-3.4.1.min.js"></script>
        <script src="./nCode _ AmÃ©lioration avec un contrÃ´leur frontal_files/popper.min.js"></script>
        <script src="./nCode _ AmÃ©lioration avec un contrÃ´leur frontal_files/bootstrap.min.js"></script>
        <script src="./nCode _ AmÃ©lioration avec un contrÃ´leur frontal_files/highlight.js"></script>
        </head><body><div class="container"><div class="markdown-body"><h1 id="1">AmÃ©lioration avec un contrÃ´leur frontal</h1>
<h2 id="2">Point d'Ã©tape</h2>
<p>Pour le moment nous avons la structure suivante:</p>
<pre><code class="language-zsh hljs bash">ğŸ“¦mvcevo
 â”£ ğŸ“œModel.php
 â”£ ğŸ“œbillet.php
 â”£ ğŸ“œgabarit.php
 â”£ ğŸ“œindex.php
 â”£ ğŸ“œstyle.css
 â”£ ğŸ“œvueAccueil.php
 â”£ ğŸ“œvueBillet.php
 â”— ğŸ“œvueErreur.php</code></pre>
<ul>
<li><code>Model.php</code> pour l'accÃ¨s aux donnÃ©es.</li>
<li><code>vueAccueil.php</code>, <code>vueBillet.php</code>, et <code>vueErreur.php</code> s'occupent de la vue.</li>
<li><code>index.php</code> et <code>billet.php</code> correspondent Ã  la partie ContrÃ´leur.</li>
</ul>
<h2 id="6">Un contrÃ´leur frontal</h2>
<p>Nous avons une architecture Ã  n contrÃ´leurs, ce n'est pas idÃ©al.</p>
<ul>
<li>cela expose le nom des fichiers php.</li>
<li>la maintenabilitÃ© du site va vite devenir difficile.</li>
</ul>
<p>Pour rÃ©soudre ce problÃ¨me, nous allons mettre en place un <strong>contrÃ´leur frontal</strong>. L'objectif de ce contrÃ´leur est de centraliser les requetes entrantes puis d'utiliser d'autres contrÃ´leurs pour rÃ©aliser l'action et de renvoyer le rÃ©sultat sous la forme d'une vue.</p>
<p>En principe on utilise <code>index.php</code> comme contrÃ´leur frontal. C'est cet <code>index.php</code> qui va recevoir les diffÃ©rentes actions Ã  effectuer. contrairement Ã  ce que nous avons pour le moment. (<code>index.php</code> pour afficher les billets et <code>billet.php?id=&lt;id du billet&gt;</code> pour afficher un billet en particulier).</p>
<p>CommenÃ§ons Ã  mettre en place deux actions:</p>
<ul>
<li>si action vaut "billet", le contrÃ´leur affichera un billet.</li>
<li>si action n'est pas valorisÃ©, le contrÃ´leur affichera tous les billets.</li>
</ul>
<pre><code class="language-php hljs"><span class="hljs-comment">// Controleur.php</span>
<span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">require</span> <span class="hljs-string">'Model.php'</span>;

<span class="hljs-comment">// Affiche la liste de tous les billets du blog</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">accueil</span><span class="hljs-params">()</span> </span>{
    $billets = getBillets();
    <span class="hljs-keyword">require</span> <span class="hljs-string">'vueAccueil.php'</span>;
}

<span class="hljs-comment">// Affiche les dÃ©tails sur un billet</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">billet</span><span class="hljs-params">($idBillet)</span> </span>{
    $billet = getBillet($idBillet);
    $commentaires = getComments($idBillet);
    <span class="hljs-keyword">require</span> <span class="hljs-string">'vueBillet.php'</span>;
}

<span class="hljs-comment">// Affiche une erreur</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">erreur</span><span class="hljs-params">($msgErreur)</span> </span>{
    <span class="hljs-keyword">require</span> <span class="hljs-string">'vueErreur.php'</span>;
}</code></pre>
<p>Il faut aussi modifier <code>index.php</code></p>
<pre><code class="language-php hljs"><span class="hljs-meta">&lt;?php</span>

<span class="hljs-keyword">require</span> <span class="hljs-string">'Controleur.php'</span>;

<span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'action'</span>])) {
        <span class="hljs-keyword">if</span>($_GET[<span class="hljs-string">'action'</span>] == <span class="hljs-string">'billet'</span>){
            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'id'</span>])){
                $idBillet = intval($_GET[<span class="hljs-string">'id'</span>]);
                <span class="hljs-keyword">if</span> ($idBillet != <span class="hljs-number">0</span>)
                    billet($idBillet);
                <span class="hljs-keyword">else</span>
                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">"id billet non valide"</span>);
            }<span class="hljs-keyword">else</span>
                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">"id billet non dÃ©fini"</span>);
        }<span class="hljs-keyword">else</span>
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-keyword">Exception</span>(<span class="hljs-string">"action non valide"</span>);
    }<span class="hljs-keyword">else</span> {
        accueil();
    }

}<span class="hljs-keyword">catch</span>(<span class="hljs-keyword">Exception</span> $e) {
    erreur($e-&gt;getMessage());
}</code></pre>
<blockquote>
<p>vous pouvez supprimer <code>billet.php</code> il est devenu inutile</p>
</blockquote>
<p>Il faut aussi modifier les liens dans la vue Accueil (<code>vueAccueil.php</code>)</p>
<pre><code class="language-php hljs">...
&lt;a href=<span class="hljs-string">"&lt;?= "</span>index.php?action=billet&amp;id=<span class="hljs-string">". $billet['id'] ?&gt;"</span>&gt;
    &lt;h1 <span class="hljs-class"><span class="hljs-keyword">class</span>="<span class="hljs-title">titreBillet</span>"&gt;&lt;?= $<span class="hljs-title">billet</span>['<span class="hljs-title">titre</span>'] ?&gt;&lt;/<span class="hljs-title">h1</span>&gt;
&lt;/<span class="hljs-title">a</span>&gt;
...</span></code></pre>
<p>En rÃ©sumÃ©, notre contrÃ´leur suit la logique suivante</p>
<p><img src="./nCode _ AmÃ©lioration avec un contrÃ´leur frontal_files/front-controller2.png" alt="front"></p>
<h2 id="21">Finissons par un peu de rangement</h2>
<p>Il faut toujours penser Ã  structurer vos sources. D'une part pour vous, mais aussi pour d'autres developpeurs qui pourraient travailler sur le projet.</p>
<p>Je vous propose la structure suivante:</p>
<pre><code class="language-zsh hljs bash">ğŸ“¦mvcevo
 â”£ ğŸ“‚BD
 â”ƒ â”— ğŸ“œblog.sql
 â”£ ğŸ“‚assets
 â”ƒ â”— ğŸ“œstyle.css
 â”£ ğŸ“‚controller
 â”ƒ â”— ğŸ“œControleur.php
 â”£ ğŸ“‚model
 â”ƒ â”— ğŸ“œModel.php
 â”£ ğŸ“‚vue
 â”ƒ â”£ ğŸ“œgabarit.php
 â”ƒ â”£ ğŸ“œvueAccueil.php
 â”ƒ â”£ ğŸ“œvueBillet.php
 â”ƒ â”— ğŸ“œvueErreur.php
 â”— ğŸ“œindex.php</code></pre>
<blockquote>
<p>AprÃ¨s ce mÃ©nage, faites bien attention Ã  verifier et corriger les chemins.</p>
</blockquote>
<p><br><br><br><br></p></div><div class="menu-markdown"><img src="./nCode _ AmÃ©lioration avec un contrÃ´leur frontal_files/menu.png"><div data-id="1" class="titre">AmÃ©lioration avec un contrÃ´leur frontal</div><div data-id="2">Point d'Ã©tape</div><div data-id="6">Un contrÃ´leur frontal</div><div data-id="21">Finissons par un peu de rangement</div></div></div><script>hljs.initHighlightingOnLoad();//hljs.initLineNumbersOnLoad();</script><script src="./nCode _ AmÃ©lioration avec un contrÃ´leur frontal_files/menu-markdown.js"></script><script>document.title = "nCode | " + document.querySelector("h1").textContent;</script></body></html>